<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <title>Editor</title>
    <link rel="stylesheet" href="/public/css/editor.css" />
    <link rel="stylesheet" href="/public/lib/editormd/editormd.css" />
</head>
<body>
    <div id="layout">
        <div id="tags-list">
            <div class="tags">

            </div>
        </div>
        <div id="test-editormd">
            <textarea style="display:none;">### 标题
----
开始正文内容</textarea>
        </div>
        <div class="btn-w">
            <div class="btn" id="save">保存为草稿</div>
            <div class="btn" id="publish">发布文章</div>
        </div>
    </div>
    <script src="/public/lib/jquery.js"></script>
    <script src="/public/lib/editormd/editormd.js"></script>
    <script type="text/javascript">
        var testEditor;
        $(function () {
            testEditor = editormd("test-editormd", {
                width: "90%",
                height: 720,
                theme:  "dark",
                saveHTMLToTextarea: true, 
                imageUpload: true,
                emoji: true,
                markdown: md,
                imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],

                previewTheme:  "dark",

                editorTheme:  "base16-dark",

                path: '/public/lib/'
            });
        });

        $("#publish").on("click", function () {
            var markdown = testEditor.getMarkdown(),
                html = testEditor.getHTML(),
                tags = [];
            $.ajax({
                url: "/article/create",
                type: "post",
                dataType: "json",
                data: {
                    html: html,
                    markdown: markdown,
                    date: +new Date(),
                    tags:tags
                },
                success: function (data) {
                    var d = data.data;
                    if (data.code == 0) {
                        location.href = '/archives';
                    } else {
                        alert(data.data.msg)
                    }
                },
                error: function () { }
            })
        })
    </script>
</body>

</html>